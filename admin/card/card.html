<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء بطاقة هوية</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 800px;
        }
        
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .card-container {
            width: 350px;
            height: 220px;
            background: linear-gradient(135deg, #ffffff 0%, #f1f1f1 100%);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .card-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .card-row {
            display: flex;
            margin-bottom: 8px;
        }
        
        .card-label {
            font-weight: bold;
            width: 100px;
            color: #555;
        }
        
        .card-value {
            flex-grow: 1;
            color: #333;
        }
        
        .card-footer {
            margin-top: 10px;
            font-size: 12px;
            color: #777;
            text-align: center;
        }
        
        .card-number {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .card-white {
            background: linear-gradient(135deg, #ffffff 0%, #f1f1f1 100%);
        }
        
        .card-black {
            background: linear-gradient(135deg, #333333 0%, #000000 100%);
            color: white;
        }
        
        .card-black .card-label,
        .card-black .card-value,
        .card-black .card-title,
        .card-black .card-footer {
            color: white;
        }
        
        .card-black .card-header {
            border-bottom: 1px solid #555;
        }
        
        .color-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #ddd;
        }
        
        .color-option.selected {
            border-color: #4CAF50;
        }
        
        .logo-preview {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>إنشاء بطاقة هوية</h1>
        
        <div class="card-container card-white" id="idCard">
            <div class="card-header">
                <div class="card-title">بطاقة الهوية</div>
                <img src="" alt="Logo" class="logo" id="cardLogo">
            </div>
            <div class="card-body">
                <div class="card-row">
                    <span class="card-label">الاسم:</span>
                    <span class="card-value" id="cardName">...</span>
                </div>
                <div class="card-row">
                    <span class="card-label">الكود:</span>
                    <span class="card-value" id="cardCode">...</span>
                </div>
                <div class="card-row">
                    <span class="card-label">الصف:</span>
                    <span class="card-value" id="cardClass">...</span>
                </div>
            </div>
            <div class="card-footer">هذه البطاقة صادرة من المدرسة</div>
            <div class="card-number" id="cardNumber"></div>
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label for="logoUpload">رفع الشعار:</label>
                <input type="file" id="logoUpload" accept="image/*">
                <img id="logoPreview" class="logo-preview" style="display: none;">
            </div>
            
            <div class="form-group">
                <label>لون البطاقة:</label>
                <div class="color-options">
                    <div class="color-option selected" style="background: linear-gradient(135deg, #ffffff 0%, #f1f1f1 100%);" data-color="white" onclick="changeCardColor('white')"></div>
                    <div class="color-option" style="background: linear-gradient(135deg, #333333 0%, #000000 100%);" data-color="black" onclick="changeCardColor('black')"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="name">الاسم:</label>
                <input type="text" id="name" placeholder="ادخل الاسم">
            </div>
            
            <div class="form-group">
                <label for="code">الكود:</label>
                <input type="text" id="code" placeholder="ادخل الكود">
            </div>
            
            <div class="form-group">
                <label for="class">الصف:</label>
                <input type="text" id="class" placeholder="ادخل الصف">
            </div>
            
            <button onclick="generateCard()">إنشاء البطاقة</button>
            <button onclick="saveCardToFirebase()" style="background-color: #2196F3; margin-top: 10px;">حفظ البطاقة</button>
        </div>
    </div>
    
    <!-- صفحة البحث عن البطاقة -->
    <div class="form-container" style="margin-top: 30px;">
        <h2>البحث عن بطاقة</h2>
        <div class="form-group">
            <label for="searchCardNumber">رقم البطاقة:</label>
            <input type="text" id="searchCardNumber" placeholder="ادخل رقم البطاقة">
        </div>
        <div class="form-group">
            <label for="searchCode">الكود:</label>
            <input type="text" id="searchCode" placeholder="ادخل الكود">
        </div>
        <button onclick="searchCard()" style="background-color: #FF9800;">بحث</button>
    </div>
    
    <!-- معاينة نتيجة البحث -->
    <div id="searchResult" style="display: none; margin-top: 20px;">
        <h2>نتيجة البحث</h2>
        <div class="card-container card-white" id="searchedCard">
            <div class="card-header">
                <div class="card-title">بطاقة الهوية</div>
                <img src="" alt="Logo" class="logo" id="searchedCardLogo">
            </div>
            <div class="card-body">
                <div class="card-row">
                    <span class="card-label">الاسم:</span>
                    <span class="card-value" id="searchedCardName">...</span>
                </div>
                <div class="card-row">
                    <span class="card-label">الكود:</span>
                    <span class="card-value" id="searchedCardCode">...</span>
                </div>
                <div class="card-row">
                    <span class="card-label">الصف:</span>
                    <span class="card-value" id="searchedCardClass">...</span>
                </div>
            </div>
            <div class="card-footer">هذه البطاقة صادرة من المدرسة</div>
            <div class="card-number" id="searchedCardNumber"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC2xr8NaXeiYuwJQa7k6qHllRY0tiBcfh8",
            authDomain: "card-bcf12.firebaseapp.com",
            projectId: "card-bcf12",
            storageBucket: "card-bcf12.appspot.com",
            messagingSenderId: "482725905996",
            appId: "1:482725905996:web:a1eec0ac4730da8edfd6e9",
            measurementId: "G-46JJKN96ZE"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // متغيرات التطبيق
        let cardData = {
            name: '',
            code: '',
            class: '',
            cardNumber: '',
            color: 'white',
            logoUrl: ''
        };
        
        // توليد رقم بطاقة عشوائي عند تحميل الصفحة
        window.onload = function() {
            generateCardNumber();
            setupLogoUpload();
        };
        
        // توليد رقم بطاقة عشوائي
        function generateCardNumber() {
            const randomNum = Math.floor(100000 + Math.random() * 900000);
            cardData.cardNumber = 'CARD-' + randomNum;
            document.getElementById('cardNumber').textContent = cardData.cardNumber;
        }
        
        // إعداد رفع الشعار
        function setupLogoUpload() {
            const logoUpload = document.getElementById('logoUpload');
            const logoPreview = document.getElementById('logoPreview');
            
            logoUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        logoPreview.src = e.target.result;
                        logoPreview.style.display = 'block';
                        document.getElementById('cardLogo').src = e.target.result;
                        cardData.logoUrl = e.target.result; // حفظ كـ base64
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // تغيير لون البطاقة
        function changeCardColor(color) {
            const card = document.getElementById('idCard');
            card.className = 'card-container card-' + color;
            
            // تحديث الأزرار المحددة
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.color-option[data-color="${color}"]`).classList.add('selected');
            
            cardData.color = color;
        }
        
        // توليد البطاقة
        function generateCard() {
            const name = document.getElementById('name').value;
            const code = document.getElementById('code').value;
            const className = document.getElementById('class').value;
            
            if (!name || !code || !className) {
                alert('الرجاء إدخال جميع البيانات المطلوبة');
                return;
            }
            
            cardData.name = name;
            cardData.code = code;
            cardData.class = className;
            
            // تحديث واجهة البطاقة
            document.getElementById('cardName').textContent = name;
            document.getElementById('cardCode').textContent = code;
            document.getElementById('cardClass').textContent = className;
            
            alert('تم إنشاء البطاقة بنجاح!');
        }
        
        // حفظ البطاقة في Firebase
        function saveCardToFirebase() {
            if (!cardData.name || !cardData.code || !cardData.class) {
                alert('الرجاء إنشاء البطاقة أولاً قبل الحفظ');
                return;
            }
            
            const cardsRef = database.ref('cards');
            const newCardRef = cardsRef.push();
            
            newCardRef.set(cardData)
                .then(() => {
                    alert('تم حفظ البطاقة بنجاح! رقم البطاقة: ' + cardData.cardNumber);
                })
                .catch((error) => {
                    alert('حدث خطأ أثناء حفظ البطاقة: ' + error.message);
                });
        }
        
        // البحث عن بطاقة
        function searchCard() {
            const cardNumber = document.getElementById('searchCardNumber').value;
            const code = document.getElementById('searchCode').value;
            
            if (!cardNumber && !code) {
                alert('الرجاء إدخال رقم البطاقة أو الكود للبحث');
                return;
            }
            
            const cardsRef = database.ref('cards');
            let query;
            
            if (cardNumber) {
                query = cardsRef.orderByChild('cardNumber').equalTo(cardNumber);
            } else {
                query = cardsRef.orderByChild('code').equalTo(code);
            }
            
            query.once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const cardData = snapshot.val();
                        const cardId = Object.keys(cardData)[0];
                        displaySearchedCard(cardData[cardId]);
                    } else {
                        alert('لم يتم العثور على بطاقة بهذه البيانات');
                        document.getElementById('searchResult').style.display = 'none';
                    }
                })
                .catch((error) => {
                    alert('حدث خطأ أثناء البحث: ' + error.message);
                });
        }
        
        // عرض نتيجة البحث
        function displaySearchedCard(card) {
            document.getElementById('searchedCardName').textContent = card.name;
            document.getElementById('searchedCardCode').textContent = card.code;
            document.getElementById('searchedCardClass').textContent = card.class;
            document.getElementById('searchedCardNumber').textContent = card.cardNumber;
            
            if (card.logoUrl) {
                document.getElementById('searchedCardLogo').src = card.logoUrl;
            }
            
            // تغيير لون البطاقة حسب البيانات المحفوظة
            const searchedCard = document.getElementById('searchedCard');
            searchedCard.className = 'card-container card-' + (card.color || 'white');
            
            document.getElementById('searchResult').style.display = 'block';
        }
    </script>
</body>
</html>