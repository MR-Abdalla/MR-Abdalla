<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>عرض بيانات الطلاب</title>
<style>
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px 10px;
    text-align: left;
  }
  th {
    background-color: #f2f2f2;
  }
</style>
</head>
<body>
<h1>بيانات الطلاب</h1>
<table id="students-table">
  <thead>
    <tr>
      <th>Student ID</th>
      <th>اسم الطالب</th>
      <th>رقم الطالب</th>
      <th>ولي الأمر</th>
      <th>الصف</th>
      <th>المحافظة</th>
      <th>المدرسة</th>
      <th>الأجهزة المسموح بها</th>
      <th>الجهاز الرئيسي</th>
      <th>اسم الجهاز</th>
      <th>نوع الجهاز</th>
      <th>نظام التشغيل</th>
      <th>المتصفح</th>
      <th>دقة الشاشة</th>
      <th>آخر نشاط</th>
      <th>الموقع (Lat,Lon)</th>
      <th>تاريخ التسجيل</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCPrQEr2OXfcjPyCRb5uT9KQKZjf5aBDg8",
    authDomain: "studint-code.firebaseapp.com",
    projectId: "studint-code",
    storageBucket: "studint-code.firebasestorage.app",
    messagingSenderId: "736980801683",
    appId: "1:736980801683:web:9e7b1f7caf90b39ded5566",
    measurementId: "G-JV9BQ5KTS9"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const tbody = document.querySelector("#students-table tbody");

  // قراءة كل الطلاب
  db.collection("students").get()
    .then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
            const location = data.location ? `${data.location.lat}, ${data.location.lon}` : "";

        const row = document.createElement("tr");
const allowedDevices = data.allowedDevices ? data.allowedDevices.join(", ") : "";
const locationLink = data.location 
    ? `<a href="https://www.google.com/maps?q=${data.location.lat},${data.location.lon}" target="_blank">افتح الموقع</a>` 
    : "";

row.innerHTML = `
  <td>${data.studentId || ""}</td>
  <td>${data.name || ""}</td>
  <td>${data.studentPhone || ""}</td>
  <td>${data.parentPhone || ""}</td>
  <td>${data.grade || ""}</td>
  <td>${data.governorate || ""}</td>
  <td>${data.school || ""}</td>
  <td>${allowedDevices}</td>
  <td>${data.mainDevice || ""}</td>
  <td>${data.deviceName || ""}</td>
  <td>${data.deviceType || ""}</td>
  <td>${data.os || ""}</td>
  <td>${data.browser || ""}</td>
  <td>${data.screenSize || ""}</td>
  <td>${data.lastActive || ""}</td>
  <td>${locationLink}</td>
  <td>${data.createdAt ? new Date(data.createdAt.seconds*1000).toLocaleString('ar-EG') : ""}</td>
`;
tbody.appendChild(row);

      });
    })
    .catch(err => console.error("حدث خطأ أثناء قراءة البيانات: ", err));
</script>
</body>
</html>
