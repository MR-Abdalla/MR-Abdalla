<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠÙ‡</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
<style>
  
</style>
</head>
<body>

<header>
  <img id="logo" src="logo.png" class="profile-avatar">
  <h1 class="app-title">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h1>
</header>

<div class="main-container">
  <div class="profile-hero">
    <div class="avatar-container">
      <img src="profile.png" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„" >
    </div>
    
    <div class="profile-info">
      <h1>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠÙ‡</h1>
    </div>

  </div>

</div>

<div class="menu-slider">
  <a href="https://mr-abdala.vercel.app/profile/" >Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="personal-info/index.html" class="active">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠÙ‡</a>
  <a href="https://mr-abdala.vercel.app/profile/security/index.html">Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡</a>
  <a href="https://mr-abdala.vercel.app/profile/wallet/login.html">Ø§Ù„Ù…Ø­ÙØ¸Ù‡</a>
  <a href="https://mr-abdala.vercel.app/profile/subscription/cors.html">Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙŠ</a>
  <a href="https://mr-abdala.vercel.app/profile/quiz/quiz.html">ÙƒÙˆØ²Ø§ØªÙŠ</a>
</div>

<!-- âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
<div class="info-box">
  <label>Ø§Ù„Ø§Ø³Ù…</label>
  <input type="text" id="nameInput" >

  <label>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
  <input type="text" id="schoolInput" >

  <label>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
  <input type="text" id="gradeInput" disabled>

  <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
  <input type="text" id="govInput" disabled>

  <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
  <input type="text" id="studentPhoneInput" disabled>

  <label>Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</label>
  <input type="text" id="parentPhoneInput" disabled>

  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
<!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
   <div class="birthdate-selects">
     <select id="birthDay"><option value="">Ø§Ù„ÙŠÙˆÙ…</option></select>
     <select id="birthMonth"><option value="">Ø§Ù„Ø´Ù‡Ø±</option></select>
     <select id="birthYear"><option value="">Ø§Ù„Ø³Ù†Ø©</option></select>
   </div>

  <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
  <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„Ù‡">

  <button class="save-btn" id="saveChanges">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</button>
</div>



<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCPrQEr2OXfcjPyCRb5uT9KQKZjf5aBDg8",
  authDomain: "studint-code.firebaseapp.com",
  projectId: "studint-code",
  storageBucket: "studint-code.firebasestorage.app",
  messagingSenderId: "736980801683",
  appId: "1:736980801683:web:9e7b1f7caf90b39ded5566",
  measurementId: "G-JV9BQ5KTS9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const daySelect = document.getElementById('birthDay');
const monthSelect = document.getElementById('birthMonth');
const yearSelect = document.getElementById('birthYear');

// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
for (let d=1; d<=31; d++){
  let opt = document.createElement('option');
  opt.value = d.toString().padStart(2,'0');
  opt.textContent = d;
  daySelect.appendChild(opt);
}

const monthNames = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
for (let m=1; m<=12; m++){
  let opt = document.createElement('option');
  opt.value = m.toString().padStart(2,'0');
  opt.textContent = monthNames[m-1];
  monthSelect.appendChild(opt);
}

const currentYear = new Date().getFullYear();
for (let y=currentYear; y>=1980; y--){
  let opt = document.createElement('option');
  opt.value = y;
  opt.textContent = y;
  yearSelect.appendChild(opt);
}

document.addEventListener('DOMContentLoaded', async () => {
  const localData = JSON.parse(localStorage.getItem('studentData')) || {};
  const studentId = localData.studentId;
  if (!studentId) return;

  const studentRef = doc(db, 'students', studentId);
  const studentSnap = await getDoc(studentRef);

  if (studentSnap.exists()) {
    const data = studentSnap.data();

    document.getElementById('nameInput').value = data.name || '';
    document.getElementById('schoolInput').value = data.school || '';
    document.getElementById('gradeInput').value = data.grade || '';
    document.getElementById('govInput').value = data.governorate || '';
    document.getElementById('studentPhoneInput').value = data.studentPhone || '';
    document.getElementById('parentPhoneInput').value = data.parentPhone || '';

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
    if (data.birthDate) {
      const birth = new Date(data.birthDate);
      daySelect.value = birth.getDate().toString().padStart(2,'0');
      monthSelect.value = (birth.getMonth()+1).toString().padStart(2,'0');
      yearSelect.value = birth.getFullYear();
    }

    const emailInput = document.getElementById('emailInput');
    if (data.email && data.email.trim() !== '') {
      emailInput.value = data.email;
      emailInput.disabled = true;
    } else {
      emailInput.value = '';
      emailInput.disabled = false;
      emailInput.placeholder = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„Ù‡";
    }

    if (data.avatar) {
      document.querySelectorAll('.profile-avatar').forEach(img => img.src = data.avatar);
    }

  }
});

// Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
document.getElementById('saveChanges').addEventListener('click', async () => {
  const email = document.getElementById('emailInput').value.trim();
  const day = daySelect.value;
  const month = monthSelect.value;
  const year = yearSelect.value;

  if (!email && (!day || !month || !year)) {
    alert('âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙƒØ§Ù…Ù„Ø§Ù‹');
    return;
  }

  const localData = JSON.parse(localStorage.getItem('studentData')) || {};
  const studentId = localData.studentId;
  if (!studentId) return;

  const updated = {};
  if (email) updated.email = email;
  if (day && month && year) updated.birthDate = `${year}-${month}-${day}`;

  try {
    const studentRef = doc(db, 'students', studentId);
    await updateDoc(studentRef, updated);
    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');

    if (email) document.getElementById('emailInput').disabled = true;
    if (day && month && year){
      daySelect.disabled = true;
      monthSelect.disabled = true;
      yearSelect.disabled = true;
    }
  } catch (error) {
    console.error(error);
    alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸');
  }
});
</script>


</body>
</html>
