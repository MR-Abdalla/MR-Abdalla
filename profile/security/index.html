<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุงููุนูููุงุช ุงูุดุฎุตูู</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
<style>
  
</style>
</head>
<body>

<header>
  <img id="logo" src="logo.png" class="profile-avatar">
  <h1 class="app-title">ูููู ุงูุดุฎุตู</h1>
</header>

<div class="main-container">
  <div class="profile-hero">
    <div class="avatar-container">
      <img src="security.png" alt="ุตูุฑุฉ ุงูุจุฑููุงูู" >
    </div>
    
    <div class="profile-info">
      <h1> ุงูุญูุงูู ู ุชุนููู ูููู ุงูุณุฑ </h1>
    </div>

  </div>

</div>

<div class="menu-slider">
  <a href="https://mr-abdala.vercel.app/profile/" >ุงูุฑุฆูุณูุฉ</a>
  <a href="https://mr-abdala.vercel.app/profile/personal-info/index.html" >ุงููุนูููุงุช ุงูุดุฎุตูู</a>
  <a href="https://mr-abdala.vercel.app/profile/security/index.html" class="active">ุงูุญูุงูู</a>
  <a href="https://mr-abdala.vercel.app/profile/wallet/login.html">ุงููุญูุธู</a>
  <a href="https://mr-abdala.vercel.app/profile/subscription/cors.html">ุงุดุชุฑุงูุงุชู</a>
  <a href="https://mr-abdala.vercel.app/profile/quiz/quiz.html">ููุฒุงุชู</a>
</div>


<div class="no-devices">
    <a href="red-login.html" style="color: rgb(0, 204, 255);">ุงูููุงููู ุนูู ุงูุงุฌูุฒู ุงูุฌุฏูุฏู</a>
</div>

<div class="devices-container">
  <div id="mainDevice"></div>
  <div id="devicesList"></div>
  <div id="noDevices" class="no-devices"></div>
</div>




<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCPrQEr2OXfcjPyCRb5uT9KQKZjf5aBDg8",
    authDomain: "studint-code.firebaseapp.com",
    projectId: "studint-code",
    storageBucket: "studint-code.firebasestorage.app",
    messagingSenderId: "736980801683",
    appId: "1:736980801683:web:9e7b1f7caf90b39ded5566"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const studentData = JSON.parse(localStorage.getItem("studentData"));
  const studentId = studentData?.studentId || "";


document.addEventListener('DOMContentLoaded', async () => {
  const localData = JSON.parse(localStorage.getItem('studentData')) || {};
  const studentId = localData.studentId;
  if (!studentId) return;

  const studentRef = doc(db, 'students', studentId);
  const studentSnap = await getDoc(studentRef);

  if (studentSnap.exists()) {
    const data = studentSnap.data();
    

    if (data.avatar) {
      document.querySelectorAll('.profile-avatar').forEach(img => img.src = data.avatar);
    }

  }
});


  // ๐ ุชุญุฏูุฏ ููุน ุงูุฌูุงุฒ
  function detectDeviceType(deviceName = "", userAgent = "") {
    const lower = (deviceName + " " + userAgent).toLowerCase();

    if (lower.includes("iphone") || lower.includes("ipad") || lower.includes("ios"))
      return { type: "iPhone / iPad", icon: "๐ฑ" };
    if (lower.includes("android"))
      return { type: "Android", icon: "๐ฑ" };
    if (lower.includes("windows"))
      return { type: "Windows PC", icon: "๐ป" };
    if (lower.includes("mac"))
      return { type: "MacBook", icon: "๐ป" };
    if (lower.includes("linux"))
      return { type: "Linux", icon: "๐ฅ๏ธ" };
    if (lower.includes("tablet"))
      return { type: "Tablet", icon: "๐" };
    return { type: "ุฌูุงุฒ ุบูุฑ ูุนุฑูู", icon: "๐" };
  }

  async function loadDevices() {
    const docRef = doc(db, "students", studentId);
    const snap = await getDoc(docRef);

    const mainDiv = document.getElementById("mainDevice");
    const listDiv = document.getElementById("devicesList");
    const noDevices = document.getElementById("noDevices");

    if (!snap.exists()) {
      noDevices.textContent = "โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุทุงูุจ";
      return;
    }

    const data = snap.data();
    const mainDeviceId = data.mainDevice?.trim();
    const allowed = data.allowedDevices || [];

    if (allowed.length === 0) {
      noDevices.textContent = "ูุง ุชูุฌุฏ ุฃุฌูุฒุฉ ูุฑุชุจุทุฉ ุญุงููุงู";
      return;
    }

    // ๐ง ุงูุฌูุงุฒ ุงูุฑุฆูุณู = ูู ููุฌูุฏ ูู string ุฃู object
    let mainDeviceObj = null;
    let otherDevices = [];

    allowed.forEach(dev => {
      if (typeof dev === "string" && dev === mainDeviceId) {
        mainDeviceObj = { deviceId: dev };
      } else if (typeof dev === "object") {
        otherDevices.push(dev);
      }
    });

    // โณ๏ธ ุนุฑุถ ุงูุฌูุงุฒ ุงูุฑุฆูุณู
    if (mainDeviceObj) {
      mainDiv.innerHTML = `
        <h2 class="section-title">โญ ุงูุฌูุงุฒ ุงูุฑุฆูุณู</h2>
        <div class="device-card main">
          <div class="device-icon">๐ฑ</div>
          <div class="device-info">
            <h3>ุงูุฌูุงุฒ ุงูุฃุตูู</h3>
            <p>ุงููุนุฑู: ${mainDeviceObj.deviceId}</p>
            <p>ููุน ุงูุฌูุงุฒ: ุบูุฑ ูุนุฑูู (ุชู ุชุณุฌููู ุฃูู ูุฑุฉ)</p>
          </div>
        </div>
      `;
    } else {
      mainDiv.innerHTML = `<h2 class="section-title">โญ ุงูุฌูุงุฒ ุงูุฑุฆูุณู</h2><p style="color:#8b949e">ุบูุฑ ูุญุฏุฏ</p>`;
    }

    // ๐งฉ ุนุฑุถ ุงูุฃุฌูุฒุฉ ุงูุฃุฎุฑู
    listDiv.innerHTML = `<h2 class="section-title">ุงูุฃุฌูุฒุฉ ุงููุฑุชุจุทุฉ</h2>`;

    otherDevices.forEach(dev => {
      const { type, icon } = detectDeviceType(dev.deviceName, dev.deviceId);
      const date = dev.approvedAt ? new Date(dev.approvedAt).toLocaleString("ar-EG") : "โ";

      listDiv.innerHTML += `
        <div class="device-card">
          <div class="device-icon">${icon}</div>
          <div class="device-info">
            <h3>${type}</h3>
            <p>ุงูุงุณู: ${dev.deviceName || "ุบูุฑ ูุญุฏุฏ"}</p>
            <p>ุงููุชุตูุญ: ${dev.deviceId?.split(" ")[0] || "ุบูุฑ ูุนุฑูู"}</p>
            <p>ุขุฎุฑ ุชุณุฌูู: ${date}</p>
          </div>
        </div>
      `;
    });
  }

  loadDevices();
</script>



<script>
/* ุชุนุทูู ูููู ูููู */
document.addEventListener("contextmenu", e => e.preventDefault());

/* ุชุนุทูู F12 ู Ctrl+Shift+I ู Ctrl+Shift+J ู Ctrl+U */
document.addEventListener("keydown", function(e) {
  if (
    e.key === "F12" ||
    (e.ctrlKey && e.shiftKey && e.key === "I") ||
    (e.ctrlKey && e.shiftKey && e.key === "J") ||
    (e.ctrlKey && e.key === "U")
  ) {
    e.preventDefault();
  }
});
</script> 
</body>
</html>
