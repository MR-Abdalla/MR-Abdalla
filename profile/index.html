<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الملف الشخصي - مستر عبدالله السيد</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>


<div class="main-container">
  <div class="profile-hero">
    <div class="avatar-container">
      <img id="profile-avatar" src="logo.png" alt="صورة البروفايل" class="profile-avatar">
      <div class="avatar-hint">انقر لتغيير صورتك الشخصية</div>
    </div>
    
    <div class="profile-info">
      <div class="student-id-badge">cod : <span id="badge-id"></span></div>
      <h1 id="student-name"></h1>
      <p id="student-grade"></p>
      <div id="student-email"><span id="badge-id-email"></span>@app.vercel.abdalla-mr</div>
    </div>

  </div>
  <div class="actions">
    <button class="btn btn-secondary" id="logout-btn">تسجيل الخروج</button>
  </div>
</div>

<div class="avatar-modal" id="avatarModal">
  <div class="avatar-modal-content">
    <div class="avatar-modal-header">
      <h2 class="avatar-modal-title">اختر صورتك الشخصية</h2>
      <button class="close-modal" id="closeModal">&times;</button>
    </div>
    <div class="avatar-grid" id="avatarGrid"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCPrQEr2OXfcjPyCRb5uT9KQKZjf5aBDg8",
  authDomain: "studint-code.firebaseapp.com",
  projectId: "studint-code",
  storageBucket: "studint-code.firebasestorage.app",
  messagingSenderId: "736980801683",
  appId: "1:736980801683:web:9e7b1f7caf90b39ded5566",
  measurementId: "G-JV9BQ5KTS9"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const avatarImages = [
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-1.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-2.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-3.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-4.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-5.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-6.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-7.png"
];

const profileAvatar = document.getElementById('profile-avatar');
const avatarModal = document.getElementById('avatarModal');
const avatarGrid = document.getElementById('avatarGrid');
const closeModal = document.getElementById('closeModal');

// قراءة بيانات الطالب
document.addEventListener('DOMContentLoaded', async ()=>{
  const localData = JSON.parse(localStorage.getItem('studentData'))||{};
  const studentId = localData.studentId;
  if(!studentId) return;

  const studentRef = doc(db,'students',studentId);
  const studentSnap = await getDoc(studentRef);
  if(studentSnap.exists()){
    const data = studentSnap.data();
    document.getElementById('student-name').textContent = data.name||'';
    document.getElementById('student-grade').textContent = data.grade||'';
    document.getElementById('badge-id').textContent = studentId;
    document.getElementById('badge-id-email').textContent = studentId;
    if(data.avatar) profileAvatar.src = data.avatar;
  }
});

// فتح/إغلاق نافذة الصور
profileAvatar.addEventListener('click', ()=> avatarModal.classList.add('active'));
closeModal.addEventListener('click', ()=> avatarModal.classList.remove('active'));
avatarModal.addEventListener('click', e=>{ if(e.target===avatarModal) avatarModal.classList.remove('active'); });

// عرض صور اختيارية
function createAvatarOptions(){
  avatarImages.forEach(imgUrl=>{
    const img = document.createElement('img');
    img.src = imgUrl;
    img.className='avatar-option';
    img.addEventListener('click', async ()=>{
      profileAvatar.src = imgUrl;
      avatarModal.classList.remove('active');
      const localData = JSON.parse(localStorage.getItem('studentData'))||{};
      localData.avatar = imgUrl;
      localStorage.setItem('studentData', JSON.stringify(localData));
      const studentId = localData.studentId;
      if(studentId){
        const studentRef = doc(db,'students',studentId);
        await updateDoc(studentRef,{avatar: imgUrl});
      }
    });
    avatarGrid.appendChild(img);
  });
}
createAvatarOptions();

// تسجيل خروج
document.getElementById('logout-btn').addEventListener('click', ()=>{
  localStorage.removeItem('studentData');
  window.location.href="https://mr-abdala.vercel.app/";
});
</script>

</body>
</html>
