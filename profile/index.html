<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุงูููู ุงูุดุฎุตู - ูุณุชุฑ ุนุจุฏุงููู ุงูุณูุฏ</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
     <img id="logo" src="logo.png" class="profile-avatar">
      <h1 class="app-title">ูููู ุงูุดุฎุตู</h1>
  </header>


<div class="main-container">
  <div class="profile-hero">
    <div class="avatar-container">
      <img id="profile-avatar" src="logo.png" alt="ุตูุฑุฉ ุงูุจุฑููุงูู" class="profile-avatar">
      <div class="avatar-hint">ุงููุฑ ูุชุบููุฑ ุตูุฑุชู ุงูุดุฎุตูุฉ</div>
    </div>
    
    <div class="profile-info">
            <div class="student-id-badge">cod : <span id="badge-id"></span></div>

      <h1>ุฃููุงู, <samp id="student-name"></samp></h1>
      <p>ุฃุฏุฑ ูุนูููุงุชู ูุฎุตูุตูุชูุ ูุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ <a href="https://wa.me/201229369115">ุชูุงุตู ูุนูุง</a> </p>
    </div>

</div>

<div class="menu-slider">
    <a href="" class="active">ุงูุฑุฆูุณูุฉ</a>
    <a href="personal-info/index.html">ุงููุนูููุงุช ุงูุดุฎุตูู</a>
    <a href="security/index.html">ุงูุญูุงูู</a>
    <a href="wallet/login.html">ุงููุญูุธู</a>
    <a href="subscription/cors.html">ุงุดุชุฑุงูุงุชู</a>
    <a href="quiz/quiz.html">ููุฒุงุชู</a>
</div>


<div class="img">
  <img src="Arabic Typography 2025 - Marwan Galal.jpeg" style="width: 100%; margin: 30px 0;">
</div>


<div class="avatar-modal" id="avatarModal">
  <div class="avatar-modal-content">
    <div class="avatar-modal-header">
      <h2 class="avatar-modal-title">ุงุฎุชุฑ ุตูุฑุชู ุงูุดุฎุตูุฉ</h2>
      <button class="close-modal" id="closeModal">&times;</button>
    </div>
    <div class="avatar-grid" id="avatarGrid"></div>
  </div>
</div>

<button class="btn logout-btn" onclick="clearStudentData()">
  ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ
</button>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCPrQEr2OXfcjPyCRb5uT9KQKZjf5aBDg8",
  authDomain: "studint-code.firebaseapp.com",
  projectId: "studint-code",
  storageBucket: "studint-code.firebasestorage.app",
  messagingSenderId: "736980801683",
  appId: "1:736980801683:web:9e7b1f7caf90b39ded5566",
  measurementId: "G-JV9BQ5KTS9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const avatarImages = [
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-1.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-2.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-3.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-4.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-5.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-6.png",
  "https://res.cloudinary.com/dmeujj1cy/image/upload/logo-profile-7.png"
];

const profileAvatars = document.querySelectorAll('.profile-avatar');
const avatarModal = document.getElementById('avatarModal');
const avatarGrid = document.getElementById('avatarGrid');
const closeModal = document.getElementById('closeModal');

// ูุฑุงุกุฉ ุจูุงูุงุช ุงูุทุงูุจ
document.addEventListener('DOMContentLoaded', async ()=>{
  const localData = JSON.parse(localStorage.getItem('studentData')) || {};
  const studentId = localData.studentId;
  if(!studentId) return;

  const studentRef = doc(db,'students',studentId);
  const studentSnap = await getDoc(studentRef);
  if(studentSnap.exists()){
    const data = studentSnap.data();
    document.getElementById('student-name').textContent = data.name || '';
    document.getElementById('badge-id').textContent = studentId;
    if(data.avatar){
      profileAvatars.forEach(img => img.src = data.avatar);
    }
  }
});

// ูุชุญ ูุฅุบูุงู ูุงูุฐุฉ ุงูุตูุฑ
profileAvatars.forEach(img => {
  img.addEventListener('click', ()=> avatarModal.classList.add('active'));
});

closeModal.addEventListener('click', ()=> avatarModal.classList.remove('active'));
avatarModal.addEventListener('click', e=>{
  if(e.target === avatarModal) avatarModal.classList.remove('active');
});

// ุนุฑุถ ุตูุฑ ุงุฎุชูุงุฑูุฉ
function createAvatarOptions(){
  avatarImages.forEach(imgUrl=>{
    const img = document.createElement('img');
    img.src = imgUrl;
    img.className='avatar-option';
    img.addEventListener('click', async ()=>{
      profileAvatars.forEach(i => i.src = imgUrl);
      avatarModal.classList.remove('active');
      const localData = JSON.parse(localStorage.getItem('studentData'))||{};
      localData.avatar = imgUrl;
      localStorage.setItem('studentData', JSON.stringify(localData));
      const studentId = localData.studentId;
      if(studentId){
        const studentRef = doc(db,'students',studentId);
        await updateDoc(studentRef,{avatar: imgUrl});
      }
    });
    avatarGrid.appendChild(img);
  });
}
createAvatarOptions();


window.clearStudentData = function () {
  // ูุณุญ ุจูุงูุงุช ุงูุทุงูุจ
  localStorage.removeItem("studentData");

  // ุชุญููู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
  window.location.href = "https://mr-abdala.vercel.app/";
};


</script>

</body>
</html>
