<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>تفاصيل الكورس - مستر عبدالله السيد</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-black: #0a0a0a;
      --secondary-black: #1a1a1a;
      --accent-orange: #FF6B35;
      --accent-light-orange: #FF9E6D;
      --accent-dark-orange: #E55A2B;
      --gold: #FFA500;
      --light-gray: #f5f5f5;
      --text-white: #ffffff;
      --text-light: #e0e0e0;
      --border-dark: #333333;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--primary-black);
      color: var(--text-light);
      line-height: 1.6;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* شعار المستر عبدالله السيد */
    .teacher-badge {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background: linear-gradient(135deg, var(--accent-orange), #D35400);
      color: white;
      padding: 8px 15px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 0.9rem;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
      border: 2px solid var(--gold);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .teacher-badge i {
      font-size: 1.1rem;
    }

    /* الهيدر الرئيسي */
    .page-header {
      background: linear-gradient(135deg, var(--primary-black), #2A1A0A);
      color: white;
      padding: 20px 15px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
      border-bottom: 3px solid var(--accent-orange);
      position: relative;
      overflow: hidden;
    }

    .page-header::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="%23FF6B35" opacity="0.1"/></svg>');
      background-size: cover;
      pointer-events: none;
    }

    .page-header h1 {
      font-size: 1.6rem;
      margin-bottom: 8px;
      color: var(--text-white);
      position: relative;
    }

    .page-header h1 span {
      color: var(--gold);
    }

    .page-header p {
      opacity: 0.9;
      font-size: 0.9rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .teacher-title {
      color: var(--accent-light-orange);
      font-weight: bold;
      margin-top: 5px;
      font-size: 1.1rem;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 0 10px;
    }

    @media (min-width: 768px) {
      .container {
        max-width: 95%;
        padding: 0 15px;
      }
      
      .page-header {
        padding: 25px 20px;
      }
      
      .page-header h1 {
        font-size: 1.9rem;
      }
    }

    @media (min-width: 1200px) {
      .container {
        max-width: 1200px;
      }
    }

    /* تصميم متجاوب للهاتف أولاً */
    .course-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (min-width: 992px) {
      .course-container {
        flex-direction: row;
        gap: 25px;
      }
    }

    .main-content {
      flex: 1;
      background-color: var(--secondary-black);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border-dark);
      width: 100%;
    }

    .sidebar {
      width: 100%;
      background-color: var(--secondary-black);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border-dark);
    }

    @media (min-width: 992px) {
      .sidebar {
        width: 350px;
        flex-shrink: 0;
      }
    }

    /* رأس الكورس */
    .course-header {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--accent-orange);
    }

    @media (min-width: 768px) {
      .course-header {
        flex-direction: row;
        align-items: flex-start;
        gap: 20px;
      }
    }

    .course-image {
      width: 100%;
      max-width: 100%;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
      border: 2px solid var(--accent-orange);
    }

    @media (min-width: 768px) {
      .course-image {
        width: 40%;
        max-width: 350px;
        margin-bottom: 0;
      }
    }

    .course-image img {
      width: 100%;
      height: auto;
      display: block;
      transition: transform 0.5s;
    }

    .course-image:hover img {
      transform: scale(1.03);
    }

    .course-info {
      flex: 1;
    }

    .course-title {
      color: var(--text-white);
      font-size: 1.5rem;
      margin-bottom: 10px;
      line-height: 1.3;
    }

    @media (min-width: 768px) {
      .course-title {
        font-size: 1.7rem;
      }
    }

    .course-description {
      margin-bottom: 15px;
      color: var(--text-light);
      font-size: 0.95rem;
    }

    .course-price {
      background: linear-gradient(135deg, var(--accent-orange), #D35400);
      color: white;
      padding: 10px 18px;
      border-radius: 10px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(255, 107, 53, 0.4);
      border: 1px solid var(--gold);
    }

    /* حاوية الفيديو متجاوبة */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* نسبة 16:9 */
      height: 0;
      margin-bottom: 20px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      background-color: #000;
      border: 2px solid var(--accent-orange);
    }

    .video-placeholder {
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #1A0A0A, #2A1A0A);
      color: white;
      text-align: center;
    }

    .video-placeholder i {
      font-size: 3rem;
      color: var(--accent-orange);
      margin-bottom: 15px;
    }

    .video-placeholder p {
      font-size: 1rem;
      opacity: 0.9;
      max-width: 300px;
    }

    /* تخصيص الفيديو إطار */
    #mainVideoFrame, #homeworkVideoFrame {
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      border-radius: 10px;
      border: none;
    }

    /* قائمة المحاضرات */
    .lectures-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    @media (min-width: 768px) {
      .lectures-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .lecture-card {
      background-color: #1f1f1f;
      border-radius: 12px;
      padding: 18px;
      border-right: 4px solid var(--accent-orange);
      border: 1px solid var(--border-dark);
      transition: all 0.3s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .lecture-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 107, 53, 0.2);
      border-color: var(--accent-light-orange);
    }

    .lecture-card.locked {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .lecture-card.completed {
      border-color: #4CAF50;
    }

    .lecture-number {
      background-color: var(--accent-orange);
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 12px;
    }

    .lecture-card-title {
      color: var(--text-white);
      font-size: 1.1rem;
      margin-bottom: 10px;
      flex-grow: 1;
    }

    .lecture-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .lecture-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .status-locked {
      background-color: #555;
      color: #bbb;
    }

    .status-unlocked {
      background-color: rgba(76, 175, 80, 0.2);
      color: #a5d6a7;
    }

    .status-quiz {
      background-color: rgba(255, 107, 53, 0.2);
      color: var(--accent-light-orange);
    }

    /* صفحة المحاضرة */
    .lecture-page {
      display: none;
      animation: fadeIn 0.5s;
    }

    .lecture-page.active {
      display: block;
    }

    .lecture-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--accent-orange);
    }

    .back-to-list {
      display: inline-flex;
      align-items: center;
      background-color: #2a2a2a;
      color: var(--text-light);
      padding: 8px 15px;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s;
      border: 1px solid var(--border-dark);
      font-size: 0.8rem;
    }

    .back-to-list:hover {
      background-color: var(--accent-orange);
      color: white;
    }

    .back-to-list i {
      margin: 5px;
    }

    .lecture-resources {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .resource-link {
      display: inline-flex;
      align-items: center;
      background-color: #2a2a2a;
      color: var(--text-light);
      padding: 10px 15px;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s;
      border: 1px solid var(--border-dark);
      font-size: 0.95rem;
      cursor: pointer;
    }

    .resource-link:hover {
      background-color: var(--accent-orange);
      color: white;
      transform: translateY(-2px);
    }

    .resource-link.active {
      background-color: var(--accent-orange);
      color: white;
      border-color: var(--accent-light-orange);
    }

    .resource-link i {
      margin-left: 8px;
    }

    .resource-link.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .resource-link.disabled:hover {
      background-color: #2a2a2a;
      color: var(--text-light);
      transform: none;
    }

    /* صفحة الكويز */
    .quiz-page {
      display: none;
      animation: fadeIn 0.5s;
    }

    .quiz-page.active {
      display: block;
    }

    .quiz-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--accent-orange);
    }

    .quiz-progress {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background-color: #2a2a2a;
      padding: 15px;
      border-radius: 10px;
    }

    .quiz-question {
      background-color: #1f1f1f;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-dark);
    }

    .quiz-question-image {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
      display: block;
    }

    .quiz-question-text {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--text-white);
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-option {
      padding: 14px 18px;
      border: 2px solid var(--border-dark);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      background-color: #2a2a2a;
      font-size: 0.95rem;
    }

    .quiz-option:hover {
      background-color: #3a3a3a;
      border-color: #555;
    }

    .quiz-option.selected {
      border-color: var(--accent-orange);
      background-color: rgba(255, 107, 53, 0.1);
    }

    .quiz-option.correct {
      border-color: #4CAF50;
      background-color: rgba(76, 175, 80, 0.2);
      color: #a5d6a7;
    }

    .quiz-option.wrong {
      border-color: var(--accent-orange);
      background-color: rgba(255, 107, 53, 0.2);
      color: #ffabab;
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
    }

    /* الأزرار */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--accent-orange), #D35400);
      color: white;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
      border: none;
      transition: all 0.3s;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
      gap: 10px;
      border: 1px solid var(--gold);
    }

    .btn:hover {
      background: linear-gradient(135deg, var(--accent-light-orange), #E55A2B);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(255, 107, 53, 0.5);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn i {
      font-size: 1.1rem;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--accent-orange);
      color: var(--accent-orange);
    }

    .btn-outline:hover {
      background-color: var(--accent-orange);
      color: white;
    }

    /* الرسائل */
    .message {
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      font-size: 0.95rem;
    }

    .message.success {
      background-color: rgba(76, 175, 80, 0.2);
      border: 1px solid #4CAF50;
      color: #a5d6a7;
    }

    .message.error {
      background-color: rgba(255, 107, 53, 0.2);
      border: 1px solid var(--accent-orange);
      color: #ffabab;
    }

    .message.info {
      background-color: rgba(33, 150, 243, 0.2);
      border: 1px solid #2196F3;
      color: #90caf9;
    }

    /* التحميل */
    .loading {
      text-align: center;
      padding: 40px 20px;
      font-size: 1.1rem;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .loading i {
      color: var(--accent-orange);
      margin-bottom: 20px;
      font-size: 2.5rem;
      animation: spin 1.5s linear infinite;
    }

    /* تذييل الصفحة */
    footer {
      background-color: var(--secondary-black);
      color: var(--text-light);
      text-align: center;
      padding: 20px 15px;
      margin-top: 30px;
      border-top: 1px solid var(--border-dark);
      font-size: 0.9rem;
    }

    .footer-logo {
      color: var(--accent-orange);
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .footer-logo span {
      color: var(--gold);
    }

    /* القائمة الجانبية للموبايل */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 100;
      background-color: var(--accent-orange);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    @media (max-width: 991px) {
      .mobile-menu-btn {
        display: flex;
      }
      
     

      .loading{
        padding: 0;
      }
    }

    /* تخصيص شريط التمرير */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-orange);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-light-orange);
    }

    /* طبقة التعتيم للهاتف */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 999;
    }

    .overlay.active {
      display: block;
    }

    /* تقدم المحاضرات */
    .progress-container {
      margin: 20px 0;
    }

    .progress-bar {
      height: 10px;
      background-color: #2a2a2a;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-orange), var(--accent-light-orange));
      border-radius: 5px;
      width: 0%;
      transition: width 0.5s ease;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-light);
    }

    /* علامات تبويب الفيديو */
    .video-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      border-bottom: 2px solid var(--border-dark);
      padding-bottom: 10px;
    }

    .video-tab {
      padding: 10px 20px;
      background-color: #2a2a2a;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
      color: var(--text-light);
      border: 1px solid transparent;
    }

    .video-tab:hover {
      background-color: #3a3a3a;
    }

    .video-tab.active {
      background-color: var(--accent-orange);
      color: white;
      border-color: var(--accent-light-orange);
    }

    @media (max-width: 450px){
      .container{
        padding: 0px;
      }

      .lecture-title{
        font-size: 14px;
      }

      .video-tab{
        font-size: 10px;
      }
      .lecture-header{
        padding: 20px;
      }
      .main-content{
        padding: 0;
        border-radius: 15px 15px 0 0;
      }
      .video-tabs{
        padding: 0 20px 10px 20px;
      }
      .video-container{
        border: 0;
        border-radius: 0;
      }
      .course-container{
        gap: 0;
        border-radius: 0 0 15px 15px;
      }
      .course-header{
        padding: 20px;
      }
      .sidebar{
        margin:  20px 0;
        border-radius: 15px;
      }
      .la{
        padding: 0 20px;
      }
      .lectures-list{
        padding: 10px;
      }
      .course-title{
        font-size: 14px;
      }
      .course-description{
        font-size: 12px;
      }
      .progress-text{
        padding: 10px 0;
      }
    }

    
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- طبقة التعتيم للجوال -->
  <div class="overlay" id="overlay"></div>

  <div class="page-header">
    <p class="teacher-title">منصه مستر عبدلله السيد</p>
  </div>

  <div class="container">
    <div id="courseBox" class="loading">
      <i class="fas fa-spinner"></i>
      <p>جارٍ تحميل بيانات الكورس...</p>
    </div>
    
    <div id="contentBox" style="display: none;">
      <!-- سيتم تعبئة هذا الجزء ديناميكيًا -->
    </div>
    
    <div id="lectureBox" style="display: none;">
      <!-- سيتم تعبئة هذا الجزء عند اختيار محاضرة -->
    </div>
  </div>

  <footer>
    <div class="footer-logo">مستر عبدالله السيد</div>
    <p>جميع الحقوق محفوظة © 2025</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { 
      getFirestore, doc, getDoc, collection, query, where, getDocs, updateDoc 
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCC5aNDvRjMZFle2tFp3vY6kb74kjVp7Dg",
      authDomain: "subscriptions-f84ee.firebaseapp.com",
      projectId: "subscriptions-f84ee",
      storageBucket: "subscriptions-f84ee.firebasestorage.app",
      messagingSenderId: "425125909485",
      appId: "1:425125909485:web:1dcdf4989d35e5e53c8de4",
      measurementId: "G-B6X1XTLM6Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("id");

    let courseData = null;
    let currentLectureIndex = 0;
    let currentQuizIndex = 0;
    let quizAnswers = [];
    let studentProgress = {};
    let currentVideoType = 'lecture'; // 'lecture' أو 'homework'

    // إدارة القائمة الجانبية للجوال
    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const overlay = document.getElementById('overlay');
      
      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function() {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar) {
            sidebar.classList.add('active');
            overlay.classList.add('active');
          }
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function() {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar) {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
          }
        });
      }

      // إغلاق القائمة عند النقر خارجها
      document.addEventListener('click', function(event) {
        const sidebar = document.querySelector('.sidebar');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        if (sidebar && sidebar.classList.contains('active') && 
            !sidebar.contains(event.target) && 
            event.target !== mobileMenuBtn) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
        }
      });
    }

    async function loadCourse() {
      const courseRef = doc(db, "courses", courseId);
      const snap = await getDoc(courseRef);

      if (!snap.exists()) {
        document.getElementById("courseBox").innerHTML = `
          <div class="message error">
            <i class="fas fa-exclamation-circle"></i>
            <h3>الكورس غير موجود</h3>
            <p>عذراً، لا يمكن العثور على الكورس المطلوب</p>
            <button class="btn" onclick="window.history.back()" style="margin-top: 15px; width: auto; padding: 10px 20px;">
              <i class="fas fa-arrow-right"></i> العودة
            </button>
          </div>
        `;
        return;
      }

      courseData = snap.data();
      
      // تحميل تقدم الطالب من localStorage
      const progressKey = `course_${courseId}_progress`;
      const savedProgress = localStorage.getItem(progressKey);
      if (savedProgress) {
        studentProgress = JSON.parse(savedProgress);
      } else {
        // تهيئة تقدم جديد
        studentProgress = {
          completedLectures: [],
          quizResults: {}
        };
        localStorage.setItem(progressKey, JSON.stringify(studentProgress));
      }

      // جلب بيانات الطالب من اللوكل
      const studentData = JSON.parse(localStorage.getItem("studentData"));

      // إذا البيانات غير موجودة → اظهر خانة الكود
      if (!studentData) {
        renderCodeInput();
        return;
      }

      // تحقق هل الطالب فعّل الكورس من قبل
      const q = query(
        collection(db, "codes"),
        where("courseId", "==", courseId),
        where("isUsed", "==", true)
      );

      const snapCodes = await getDocs(q);

      const codeUsedByStudent = snapCodes.docs.find(doc => {
        const d = doc.data();
        return d.usedBy && d.usedBy.studentId === studentData.studentId;
      });

      if (codeUsedByStudent) {
        // عرض المحتوى مباشرة
        showCourseContent();
      } else {
        // لم يفعل → اظهر خانة الكود
        renderCodeInput();
      }
    }

    function renderCodeInput() {
      document.getElementById("courseBox").innerHTML = `
        <div class="course-container">
          <div class="main-content">
            <div class="course-header">
              <div class="course-image">
                <img src="${courseData.image || 'https://via.placeholder.com/400x250/1a0a0a/FF6B35?text=مستر+عبدالله+السيد'}" alt="${courseData.title}">
              </div>
              <div class="course-info">
                <h1 class="course-title">${courseData.title}</h1>
                <p class="course-description">${courseData.description || 'كورس تعليمي متكامل يشرح المنهج بأسلوب مبسط وسهل'}</p>
                <div class="course-price">
                  <i class="fas fa-tag"></i> السعر: ${courseData.price || '150'} جنيه
                </div>
              </div>
            </div>
            
            <div class="section-title" style="color: var(--accent-light-orange); font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
              <i class="fas fa-info-circle"></i> مميزات الكورس
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));  padding: 15px; gap: 15px; margin-bottom: 20px;">
              <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; border-right: 3px solid var(--accent-orange);">
                <i class="fas fa-video" style="color: var(--accent-orange); margin-bottom: 8px; font-size: 1.2rem;"></i>
                <div style="font-weight: bold;">فيديوهات شرح عالية الجودة</div>
              </div>
              <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; border-right: 3px solid var(--accent-orange);">
                <i class="fas fa-file-pdf" style="color: var(--accent-orange); margin-bottom: 8px; font-size: 1.2rem;"></i>
                <div style="font-weight: bold;">ملخصات وملفات PDF</div>
              </div>
              <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; border-right: 3px solid var(--accent-orange);">
                <i class="fas fa-question-circle" style="color: var(--accent-orange); margin-bottom: 8px; font-size: 1.2rem;"></i>
                <div style="font-weight: bold;">تمارين واختبارات تفاعلية</div>
              </div>
            </div>
          </div>
          
          <div class="sidebar">
            <div class="activation-section">
              <h3 class="section-title" style="color: white; font-size: 1.3rem; margin-bottom: 15px;">
                <i class="fas fa-key"></i> تفعيل الكورس
              </h3>
              
              <input type="text" id="codeInput" class="code-input" placeholder="أدخل كود التفعيل" dir="ltr" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-dark); background-color: #2a2a2a; color: white; margin-bottom: 15px;">
              
              <button class="btn" onclick="checkCode()" style="width: 60%;">
                <i class="fas fa-check"></i> تفعيل الكورس الآن
              </button>
              
              <div id="msg" class="message"></div>
            </div>
          </div>
        </div>
      `;
      
      // إعداد القائمة الجانبية للجوال
      setupMobileMenu();
    }

    window.checkCode = async function () {
      const code = document.getElementById("codeInput").value.trim();
      const msg = document.getElementById("msg");

      const studentData = JSON.parse(localStorage.getItem("studentData"));
      if (!studentData) { 
        msg.innerHTML = `<div class="message error"><i class="fas fa-exclamation-triangle"></i> لم يتم تسجيل بيانات الطالب. يرجى تسجيل الدخول أولاً.</div>`;
        return; 
      }

      msg.innerHTML = `<div style="text-align:center;"><i class="fas fa-spinner fa-spin"></i> جاري التحقق من الكود...</div>`;

      setTimeout(async () => {
        const q = query(
          collection(db, "codes"),
          where("courseId", "==", courseId),
          where("code", "==", code)
        );

        const snap = await getDocs(q);
        if (snap.empty) { 
          msg.innerHTML = `<div class="message error"><i class="fas fa-times-circle"></i> الكود غير صحيح. يرجى التأكد وإعادة المحاولة.</div>`;
          return; 
        }

        const docRef = snap.docs[0].ref;
        const data = snap.docs[0].data();

        if (data.isUsed && data.usedBy && data.usedBy.studentId === studentData.studentId) {
          msg.innerHTML = `<div class="message error"><i class="fas fa-info-circle"></i> لقد قمت بتفعيل هذا الكورس مسبقاً.</div>`;
          return;
        }

        if (data.isUsed && (!data.usedBy || data.usedBy.studentId !== studentData.studentId)) {
          msg.innerHTML = `<div class="message error"><i class="fas fa-ban"></i> هذا الكود مستخدم من قبل طالب آخر.</div>`;
          return;
        }

        await updateDoc(docRef, {
          isUsed: true,
          usedBy: {
            name: studentData.name,
            parentPhone: studentData.parentPhone,
            school: studentData.school,
            studentId: studentData.studentId,
            id: snap.docs[0].id
          },
          usedAt: new Date().toISOString()
        });

        msg.innerHTML = `<div class="message success"><i class="fas fa-check-circle"></i> تم تفعيل الكورس بنجاح! جاري تحميل المحتوى...</div>`;

        setTimeout(() => {
          showCourseContent();
        }, 1500);
      }, 1000);
    };

    function showCourseContent() {
      document.getElementById("courseBox").style.display = "none";
      document.getElementById("contentBox").style.display = "block";
      
      const d = courseData;
      
      // حساب التقدم
      const totalLectures = d.lectures ? d.lectures.length : 0;
      const completedLectures = studentProgress.completedLectures ? studentProgress.completedLectures.length : 0;
      const progressPercentage = totalLectures > 0 ? Math.round((completedLectures / totalLectures) * 100) : 0;
      
      // إنشاء HTML لقائمة المحاضرات
      let lecturesHTML = "";
      if (d.lectures && d.lectures.length > 0) {
        d.lectures.forEach((lecture, index) => {
          const isCompleted = studentProgress.completedLectures && studentProgress.completedLectures.includes(index);
          const isPreviousCompleted = index === 0 || (studentProgress.completedLectures && studentProgress.completedLectures.includes(index - 1));
          const isUnlocked = index === 0 || isPreviousCompleted;
          const hasQuiz = lecture.quiz && lecture.quiz.length > 0;
          
          let statusClass = "status-locked";
          let statusText = "مقفل";
          
          if (isCompleted) {
            statusClass = "status-unlocked";
            statusText = "مكتمل";
          } else if (isUnlocked) {
            statusClass = "status-quiz";
            statusText = "جاهز";
          }
          
          lecturesHTML += `
            <div class="lecture-card ${isUnlocked ? '' : 'locked'} ${isCompleted ? 'completed' : ''}" 
                 onclick="${isUnlocked ? `selectLecture(${index})` : ''}">
              <div class="lecture-number">${index + 1}</div>
              <h3 class="lecture-card-title">${lecture.title}</h3>
              <div class="lecture-meta">
                <div class="lecture-status ${statusClass}">${statusText}</div>
              </div>
            </div>
          `;
        });
      }
      
      // عرض المحتوى النهائي
      document.getElementById("contentBox").innerHTML = `
        <div class="course-container">
          <div class="main-content">
            <div class="course-header">
              <div class="course-image">
                <img src="${d.image || 'https://via.placeholder.com/400x250/1a0a0a/FF6B35?text=مستر+عبدالله+السيد'}" alt="${d.title}">
              </div>
              <div class="course-info">
                <h1 class="course-title">${d.title}</h1>
                <p class="course-description">${d.description || 'كورس تعليمي متكامل يشرح المنهج بأسلوب مبسط وسهل'}</p>
                
                <div class="progress-container">
                  <div class="progress-text">
                    <span>تقدمك في الكورس</span>
                    <span>${completedLectures}/${totalLectures} محاضرات (${progressPercentage}%)</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div style="margin: 25px 0;">
              <h3 class="la" style="color: var(--accent-light-orange); font-size: 1.4rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
                <i class="fas fa-list-ol"></i> قائمة المحاضرات
              </h3>
              
              ${d.lectures && d.lectures.length > 0 ? `
                <div class="lectures-list">
                  ${lecturesHTML}
                </div>
              ` : `
                <div class="message info">
                  <i class="fas fa-info-circle"></i>
                  <p>لا توجد محاضرات متاحة لهذا الكورس حالياً.</p>
                </div>
              `}
            </div>
          </div>
          
          <div class="sidebar">
            <h3 style="color: var(--accent-light-orange); font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
              <i class="fas fa-info-circle"></i> معلومات الكورس
            </h3>
            
            <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span><i class="fas fa-chalkboard-teacher"></i> عدد المحاضرات:</span>
                <span style="color: var(--accent-orange); font-weight: bold;">${totalLectures}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span><i class="fas fa-video"></i> الفيديوهات:</span>
                <span style="color: var(--accent-orange); font-weight: bold;">${totalLectures}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span><i class="fas fa-file-pdf"></i> ملفات PDF:</span>
                <span style="color: var(--accent-orange); font-weight: bold;">${d.lectures ? d.lectures.filter(l => l.pdfLink).length : 0}</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span><i class="fas fa-question-circle"></i> اختبارات:</span>
                <span style="color: var(--accent-orange); font-weight: bold;">
                  ${d.lectures ? d.lectures.reduce((total, lec) => total + (lec.quiz ? lec.quiz.length : 0), 0) : 0}
                </span>
              </div>
            </div>
            
            <h3 style="color: var(--accent-light-orange); font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
              <i class="fas fa-graduation-cap"></i> نصائح مستر عبدالله
            </h3>
            
            <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>يجب حل الكويز قبل كل محاضرة لفتح المحتوى</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>شاهد الفيديوهات بتركيز وخذ ملاحظات</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>استخدم ملفات PDF للمراجعة قبل الامتحان</span>
              </p>
              <p style="display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>حل جميع التمارين والاختبارات</span>
              </p>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
              <div style="background: linear-gradient(135deg, #1A0A0A, #2A1A0A); padding: 15px; border-radius: 10px; border: 1px solid var(--accent-orange);">
                <p style="color: var(--gold); font-weight: bold; margin-bottom: 8px;">مستر عبدالله السيد</p>
                <p style="font-size: 0.9rem; opacity: 0.9;">خبير منهج الفيزياء</p>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // إعداد القائمة الجانبية للجوال
      setupMobileMenu();
    }

    // اختيار محاضرة
    window.selectLecture = function(lectureIndex) {
      currentLectureIndex = lectureIndex;
      const lecture = courseData.lectures[lectureIndex];
      
      // تحقق إذا كان هناك كويز للمحاضرة
      const hasQuiz = lecture.quiz && lecture.quiz.length > 0;
      const quizCompleted = studentProgress.quizResults && studentProgress.quizResults[lectureIndex] === true;
      
      if (hasQuiz && !quizCompleted) {
        // عرض الكويز أولاً
        showQuiz(lectureIndex);
      } else {
        // عرض المحاضرة مباشرة
        showLecture(lectureIndex);
      }
    };

    // عرض الكويز
    function showQuiz(lectureIndex) {
      const lecture = courseData.lectures[lectureIndex];
      const quiz = lecture.quiz;
      
      if (!quiz || quiz.length === 0) {
        showLecture(lectureIndex);
        return;
      }
      
      // إعادة تهيئة إجابات الكويز
      quizAnswers = new Array(quiz.length).fill(null);
      currentQuizIndex = 0;
      
      document.getElementById("contentBox").style.display = "none";
      document.getElementById("lectureBox").style.display = "block";
      
      // إنشاء واجهة الكويز
      document.getElementById("lectureBox").innerHTML = `
        <div class="course-container">
          <div class="main-content">
            <div class="quiz-page active">
              <div class="quiz-header">
                <h2 style="color: var(--accent-light-orange); margin-bottom: 10px;">
                  <i class="fas fa-question-circle"></i> اختبار المحاضرة ${lectureIndex + 1}
                </h2>
                <p style="color: var(--text-light);">${lecture.title}</p>
                <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
                  يجب حل جميع الأسئلة بشكل صحيح لفتح المحاضرة
                </p>
              </div>
              
              <div class="quiz-progress">
                <div>
                  <strong>السؤال:</strong> <span id="currentQuestion">1</span> / <span id="totalQuestions">${quiz.length}</span>
                </div>
                <div>
                  <strong>الإجابات:</strong> <span id="answeredCount">0</span> / <span id="totalQuestions2">${quiz.length}</span>
                </div>
              </div>
              
              <div id="quizContent">
                <!-- سيتم تحديث محتوى الكويز هنا -->
              </div>
              
              <div class="quiz-navigation">
                <button class="btn btn-outline" id="prevQuestion" onclick="changeQuizQuestion(-1)" disabled>
                  <i class="fas fa-arrow-right"></i> السابق
                </button>
                <button class="btn" id="nextQuestion" onclick="changeQuizQuestion(1)">
                  التالي <i class="fas fa-arrow-left"></i>
                </button>
              </div>
              
              <div style="text-align: center; margin-top: 30px;">
                <button class="btn" id="submitQuiz" onclick="submitQuiz(${lectureIndex})" style="display: none;">
                  <i class="fas fa-paper-plane"></i> تقديم الإجابات
                </button>
              </div>
            </div>
          </div>
          
          <div class="sidebar">
           
            
            <h3 style="color: var(--accent-light-orange); font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
              <i class="fas fa-info-circle"></i> تعليمات الاختبار
            </h3>
            
            <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>اختر الإجابة الصحيحة لكل سؤال</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>يمكنك التعديل على إجاباتك قبل التقديم</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>يجب الإجابة على جميع الأسئلة</span>
              </p>
              <p style="display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-check-circle" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>يجب الإجابة بشكل صحيح على جميع الأسئلة لفتح المحاضرة</span>
              </p>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
              <button class="btn btn-outline" onclick="cancelQuiz()">
                <i class="fas fa-times"></i> إلغاء والعودة للقائمة
              </button>
            </div>
          </div>
        </div>
      `;
      
      // إعداد القائمة الجانبية للجوال
      setupMobileMenu();
      
      // إضافة زر إغلاق للقائمة الجانبية
      const closeSidebar = document.getElementById('closeSidebar');
      if (closeSidebar) {
        closeSidebar.addEventListener('click', function() {
          document.querySelector('.sidebar').classList.remove('active');
          overlay.classList.remove('active');
        });
      }
      
      // عرض السؤال الأول
      updateQuizDisplay();
    }

    // تحديث عرض الكويز
    function updateQuizDisplay() {
      const lecture = courseData.lectures[currentLectureIndex];
      const quiz = lecture.quiz;
      const currentQuestion = quiz[currentQuizIndex];
      
      if (!currentQuestion) return;
      
      document.getElementById("currentQuestion").textContent = currentQuizIndex + 1;
      document.getElementById("totalQuestions").textContent = quiz.length;
      document.getElementById("totalQuestions2").textContent = quiz.length;
      
      // حساب عدد الإجابات
      const answeredCount = quizAnswers.filter(answer => answer !== null).length;
      document.getElementById("answeredCount").textContent = answeredCount;
      
      // تحديث أزرار التنقل
      document.getElementById("prevQuestion").disabled = currentQuizIndex === 0;
      document.getElementById("nextQuestion").style.display = currentQuizIndex < quiz.length - 1 ? "inline-flex" : "none";
      document.getElementById("submitQuiz").style.display = answeredCount === quiz.length ? "inline-flex" : "none";
      
      // تحديث محتوى السؤال
      const quizContent = document.getElementById("quizContent");
      quizContent.innerHTML = `
        <div class="quiz-question">
          ${currentQuestion.questionImage ? `
            <img src="${currentQuestion.questionImage}" class="quiz-question-image" alt="صورة السؤال">
          ` : ""}
          
          <div class="quiz-question-text">
            السؤال ${currentQuizIndex + 1}: ${currentQuestion.questionText || "اختر الإجابة الصحيحة"}
          </div>
          
          <div class="quiz-options">
            ${currentQuestion.options.map((option, index) => `
              <div class="quiz-option ${quizAnswers[currentQuizIndex] === index ? 'selected' : ''}" 
                   onclick="selectQuizAnswer(${index})">
                ${option.text}
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // تغيير سؤال الكويز
    window.changeQuizQuestion = function(direction) {
      const lecture = courseData.lectures[currentLectureIndex];
      const quiz = lecture.quiz;
      
      currentQuizIndex += direction;
      if (currentQuizIndex < 0) currentQuizIndex = 0;
      if (currentQuizIndex >= quiz.length) currentQuizIndex = quiz.length - 1;
      
      updateQuizDisplay();
    }

    // اختيار إجابة في الكويز
    window.selectQuizAnswer = function(answerIndex) {
      quizAnswers[currentQuizIndex] = answerIndex;
      updateQuizDisplay();
    }

    // تقديم الكويز
    window.submitQuiz = function(lectureIndex) {
      const lecture = courseData.lectures[lectureIndex];
      const quiz = lecture.quiz;
      
      // التحقق من صحة جميع الإجابات
      let allCorrect = true;
      for (let i = 0; i < quiz.length; i++) {
        if (quizAnswers[i] !== quiz[i].correct) {
          allCorrect = false;
          break;
        }
      }
      
      if (allCorrect) {
        // حفظ نتيجة الكويز
        if (!studentProgress.quizResults) {
          studentProgress.quizResults = {};
        }
        studentProgress.quizResults[lectureIndex] = true;
        
        // حفظ التقدم
        const progressKey = `course_${courseId}_progress`;
        localStorage.setItem(progressKey, JSON.stringify(studentProgress));
        
        // عرض رسالة النجاح
        document.getElementById("quizContent").innerHTML = `
          <div class="message success" style="text-align: center; padding: 30px;">
            <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h3 style="color: #4CAF50; margin-bottom: 10px;">تهانينا!</h3>
            <p>لقد أجبت على جميع الأسئلة بشكل صحيح.</p>
            <p style="margin-top: 15px;">يمكنك الآن مشاهدة محتوى المحاضرة.</p>
            <button class="btn" onclick="showLecture(${lectureIndex})" style="margin-top: 20px;">
              <i class="fas fa-play-circle"></i> عرض المحاضرة
            </button>
          </div>
        `;
        
        // إخفاء أزرار التنقل والتقديم
        document.getElementById("prevQuestion").style.display = "none";
        document.getElementById("nextQuestion").style.display = "none";
        document.getElementById("submitQuiz").style.display = "none";
      } else {
        // عرض رسالة الخطأ
        document.getElementById("quizContent").innerHTML = `
          <div class="message error" style="text-align: center; padding: 30px;">
            <i class="fas fa-times-circle" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h3 style="color: var(--accent-orange); margin-bottom: 10px;">عذراً!</h3>
            <p>بعض إجاباتك غير صحيحة. يرجى المراجعة والمحاولة مرة أخرى.</p>
            <button class="btn" onclick="retryQuiz(${lectureIndex})" style="margin-top: 20px;">
              <i class="fas fa-redo"></i> حاول مرة أخرى
            </button>
          </div>
        `;
      }
    }

    // إعادة محاولة الكويز
    window.retryQuiz = function(lectureIndex) {
      quizAnswers = new Array(courseData.lectures[lectureIndex].quiz.length).fill(null);
      currentQuizIndex = 0;
      updateQuizDisplay();
    }

    // إلغاء الكويز
    window.cancelQuiz = function() {
      document.getElementById("lectureBox").style.display = "none";
      document.getElementById("contentBox").style.display = "block";
    }

    // دالة لاستخراج ID الفيديو من رابط اليوتيوب
    function getYouTubeEmbedUrl(youtubeUrl) {
      if (!youtubeUrl) return '';
      
      // استخراج ID الفيديو
      let videoId = '';
      
      // لحالات مختلفة من روابط اليوتيوب
      if (youtubeUrl.includes('youtu.be/')) {
        // روابط مختصرة: https://youtu.be/R8IK61CsUMU
        videoId = youtubeUrl.split('youtu.be/')[1]?.split('?')[0];
      } else if (youtubeUrl.includes('youtube.com/watch?v=')) {
        // روابط عادية: https://www.youtube.com/watch?v=R8IK61CsUMU
        videoId = youtubeUrl.split('v=')[1]?.split('&')[0];
      } else if (youtubeUrl.includes('youtube.com/embed/')) {
        // روابط embed: https://www.youtube.com/embed/R8IK61CsUMU
        videoId = youtubeUrl.split('embed/')[1]?.split('?')[0];
      } else if (youtubeUrl.includes('youtube.com/v/')) {
        // روابط قديمة: https://www.youtube.com/v/R8IK61CsUMU
        videoId = youtubeUrl.split('v/')[1]?.split('?')[0];
      }
      
      // تنظيف ID الفيديو
      if (videoId && videoId.length === 11) {
        return `https://www.youtube.com/embed/${videoId}`;
      }
      
      return ''; // إذا لم يتم استخراج ID صالح
    }

    // عرض المحاضرة بعد اجتياز الكويز
    function showLecture(lectureIndex) {
      const lecture = courseData.lectures[lectureIndex];
      
      document.getElementById("lectureBox").style.display = "block";
      document.getElementById("contentBox").style.display = "none";
      
      // تحديث حالة المحاضرة كمكتملة
      if (!studentProgress.completedLectures.includes(lectureIndex)) {
        studentProgress.completedLectures.push(lectureIndex);
        const progressKey = `course_${courseId}_progress`;
        localStorage.setItem(progressKey, JSON.stringify(studentProgress));
      }
      
      // استخراج روابط الفيديو
      const lectureVideoUrl = getYouTubeEmbedUrl(lecture.videoLink);
      const homeworkVideoUrl = getYouTubeEmbedUrl(lecture.homeworkVideo);
      
      // إنشاء واجهة المحاضرة
      document.getElementById("lectureBox").innerHTML = `
        <div class="course-container">
          <div class="main-content">
            <div class="lecture-page active">
              <div class="lecture-header">
                <div>
                  <h2 class="lecture-title" style="color: var(--accent-light-orange); margin-bottom: 5px;">
                    <i class="fas fa-chalkboard-teacher"></i> المحاضرة ${lectureIndex + 1}: ${lecture.title}
                  </h2>
                </div>
                <button class="back-to-list" onclick="backToLecturesList()">
                  <i class="fas fa-arrow-right"></i> العودة للقائمة
                </button>
              </div>
              
              <!-- علامات تبويب الفيديو -->
              <div class="video-tabs" id="videoTabs">
                <div class="video-tab active" onclick="switchVideoTab('lecture')">
                  <i class="fas fa-play-circle"></i> فيديو الشرح
                </div>
                ${lecture.homeworkVideo ? `
                  <div class="video-tab" onclick="switchVideoTab('homework')">
                    <i class="fas fa-tasks"></i> فيديو الواجب
                  </div>
                ` : ''}
              </div>
              
              <!-- حاوية الفيديو -->
              <div class="video-container">
                <iframe 
                  id="mainVideoFrame"
                  width="100%" 
                  height="100%" 
                  src="${lectureVideoUrl || 'https://www.youtube.com/embed/dQw4w9WgXcQ'}" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen
                  title="فيديو المحاضرة"
                >
                </iframe>
                
                ${lecture.homeworkVideo ? `
                  <iframe 
                    id="homeworkVideoFrame"
                    width="100%" 
                    height="100%" 
                    src="${homeworkVideoUrl}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen
                    title="فيديو الواجب"
                    style="display: none;"
                  >
                  </iframe>
                ` : ''}
              </div>
              
              <div class="lecture-resources">
                ${lecture.pdfLink ? `
                  <a href="${lecture.pdfLink}" target="_blank" class="resource-link">
                    <i class="fas fa-file-pdf"></i> تحميل ملف PDF
                  </a>
                ` : ''}
                
                ${lecture.images && lecture.images.length > 0 ? `
                  <a href="#" class="resource-link" onclick="showLectureImages(${lectureIndex}); return false;">
                    <i class="fas fa-images"></i> صور المحاضرة
                  </a>
                ` : ''}
              </div>
              
              ${lecture.description ? `
                <div style="background-color: #1f1f1f; border-radius: 12px; padding: 20px; margin-top: 20px; border: 1px solid var(--border-dark);">
                  <h3 style="color: var(--text-white); margin-bottom: 10px;">
                    <i class="fas fa-info-circle"></i> وصف المحاضرة
                  </h3>
                  <p style="color: var(--text-light);">${lecture.description}</p>
                </div>
              ` : ''}
            </div>
          </div>
          
          <div class="sidebar">
            
            
            
            <h3 style="color: var(--accent-light-orange); font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-orange);">
              <i class="fas fa-lightbulb"></i> نصائح مهمة
            </h3>
            
            <div style="background-color: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-star" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>شاهد فيديو الشرح أولاً بتركيز</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-star" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>ثم شاهد فيديو الواجب لحل التمارين</span>
              </p>
              <p style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-star" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>حمل ملف PDF للمراجعة السريعة</span>
              </p>
              <p style="display: flex; align-items: flex-start; gap: 10px;">
                <i class="fas fa-star" style="color: var(--accent-orange); margin-top: 3px;"></i>
                <span>اكتب الملاحظات أثناء المشاهدة</span>
              </p>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
              <button class="btn" onclick="markAsCompleted(${lectureIndex})" style="width: 100%;">
                <i class="fas fa-check-double"></i> تمت المشاهدة
              </button>
            </div>
          </div>
        </div>
      `;
      
      // إعداد القائمة الجانبية للجوال
      setupMobileMenu();
      
      // إضافة زر إغلاق للقائمة الجانبية
      const closeSidebar = document.getElementById('closeSidebar');
      if (closeSidebar) {
        closeSidebar.addEventListener('click', function() {
          document.querySelector('.sidebar').classList.remove('active');
          overlay.classList.remove('active');
        });
      }
    }

    // تبديل بين فيديو الشرح وفيديو الواجب
    window.switchVideoTab = function(tabType) {
      currentVideoType = tabType;
      
      // تحديث علامات التبويب النشطة
      const tabs = document.querySelectorAll('.video-tab');
      tabs.forEach(tab => {
        if (tab.textContent.includes(tabType === 'lecture' ? 'الشرح' : 'الواجب')) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // تبديل الفيديوهات
      const mainVideoFrame = document.getElementById('mainVideoFrame');
      const homeworkVideoFrame = document.getElementById('homeworkVideoFrame');
      
      if (tabType === 'lecture') {
        if (mainVideoFrame) mainVideoFrame.style.display = 'block';
        if (homeworkVideoFrame) homeworkVideoFrame.style.display = 'none';
      } else if (tabType === 'homework') {
        if (mainVideoFrame) mainVideoFrame.style.display = 'none';
        if (homeworkVideoFrame) homeworkVideoFrame.style.display = 'block';
      }
    }

    // عرض صور المحاضرة
    window.showLectureImages = function(lectureIndex) {
      const lecture = courseData.lectures[lectureIndex];
      
      if (!lecture.images || lecture.images.length === 0) return;
      
      const imagesHTML = lecture.images.map(img => `
        <div style="margin-bottom: 15px;">
          <img src="${img}" style="width: 100%; border-radius: 8px; border: 2px solid var(--border-dark);">
        </div>
      `).join('');
      
      // عرض الصور في نافذة منبثقة
      document.getElementById("lectureBox").innerHTML += `
        <div id="imagesModal" style="position: fixed; top: 0; right: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
          <div style="background-color: var(--secondary-black); border-radius: 15px; padding: 20px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="color: var(--accent-light-orange);">
                <i class="fas fa-images"></i> صور المحاضرة ${lectureIndex + 1}
              </h3>
              <button onclick="closeImagesModal()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div>
              ${imagesHTML}
            </div>
            <div style="text-align: center; margin-top: 20px;">
              <button class="btn" onclick="closeImagesModal()">
                <i class="fas fa-times"></i> إغلاق
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // إغلاق نافذة الصور
    window.closeImagesModal = function() {
      const modal = document.getElementById("imagesModal");
      if (modal) {
        modal.remove();
      }
    }

    // العودة لقائمة المحاضرات
    window.backToLecturesList = function() {
      document.getElementById("lectureBox").style.display = "none";
      document.getElementById("contentBox").style.display = "block";
      showCourseContent(); // تحديث القائمة لعرض التقدم الجديد
    }

    // تحديد المحاضرة كمكتملة
    window.markAsCompleted = function(lectureIndex) {
      if (!studentProgress.completedLectures.includes(lectureIndex)) {
        studentProgress.completedLectures.push(lectureIndex);
        const progressKey = `course_${courseId}_progress`;
        localStorage.setItem(progressKey, JSON.stringify(studentProgress));
        
        // عرض رسالة تأكيد
        alert("تم تحديد المحاضرة كمكتملة!");
        backToLecturesList();
      }
    }

    // تحميل الكورس عند بدء الصفحة
    loadCourse();
  </script>
</body>
</html>