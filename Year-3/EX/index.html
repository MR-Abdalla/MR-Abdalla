<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</title>
      <style>
        /* Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØµÙØ­Ø© */
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            align-items: center;
            justify-content: center;
            background-color: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            direction: rtl;
        }

        /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */
        h1 {
            color: #4CAF50;
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            font-size: 2.2em;
        }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ */
        .student-info {
            background-color: #252525;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .student-info p {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .student-info strong {
            color: #4CAF50;
            margin-left: 10px;
        }

        .student-info span {
            color: #ffffff;
        }

        /* Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */
        #examName {
            width: 90%;
            padding: 12px;
            margin: 15px 0px;
            border: 1px solid #333;
            border-radius: 6px;
            background-color: #252525 !important;
            color: #e0e0e0;
            font-size: 1.1em;
            text-align: center;
            cursor: not-allowed !important;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
        #examContainer {
            background-color: #252525;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
        .question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .question p {
            font-weight: bold;
            font-size: 1.1em;
            color: #f0f0f0;
        }

        .question label {
            display: block;
            border-radius: 5px;
            transition: background-color 0.3s;
            cursor: pointer;
        }

        .question label:hover {
            background-color: #333;
        }

        .question input[type="radio"] {
            margin-left: 10px;
        }

        /* Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */
        #submitExam {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: block;
            font-size: 1.2em;
            margin: 25px auto;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s, transform 0.2s;
            width: 200px;
        }

        #submitExam:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        #submitExam:active {
            transform: translateY(0);
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .student-info, #examContainer {
                padding: 15px;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        input:focus, button:focus {
            outline: 2px solid #4CAF50;
            outline-offset: 2px;
        }

        /* Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± */
        #submitExam.loading {
            position: relative;
            color: transparent;
        }

        #submitExam.loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯ ØªØ­Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
<!-- Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯ -->
<h1>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
<div id="timer" style="text-align:center;font-size:1.5em;color:#ff5252;margin-bottom:20px;"></div>

<div class="student-info">
  <p><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> <span id="studentName"></span></p>
  <p><strong>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> <span id="studentId"></span></p>
  <p><strong>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</strong> <span id="studentSchool"></span></p>
</div>

<!-- Ø¨Ø¯Ù„ Ø§Ù„Ù€ input Ø§Ù„Ù‚Ø¯ÙŠÙ… -->
<input type="text" id="examName" value="Ø§Ù„ÙØ²ÙŠØ§Ø¡" readonly>

<div id="examContainer"></div>
<button id="submitExam">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBMN_54z41PR6u-dITJSjBvcNGmpgoE13k",
    authDomain: "exames-1.firebaseapp.com",
    projectId: "exames-1",
    storageBucket: "exames-1.firebasestorage.app",
    messagingSenderId: "649493227824",
    appId: "1:649493227824:web:6fcd77ccf1881d993600f5",
    measurementId: "G-EQ2R6WB790"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† localStorage
  const studentData = JSON.parse(localStorage.getItem("studentData"));
  if (!studentData) {
    alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ø§Ù„Ø¨. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
    window.location.href = "login.html";
  }

  // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
  document.getElementById("studentName").textContent = studentData.name;
  document.getElementById("studentId").textContent = studentData.studentId;
  document.getElementById("studentSchool").textContent = studentData.school;

  // Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
  const examData = [
    { question: "Ø¹Ø§ØµÙ…Ø© Ù…ØµØ± Ù‡ÙŠØŸ", options: ["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"], correct: "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©" },
    { question: "2 + 2 = ØŸ", options: ["3", "4"], correct: "4" },
    { question: "Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø¢Ø³ÙŠØ§", "Ø£ÙØ±ÙŠÙ‚ÙŠØ§"], correct: "Ø¢Ø³ÙŠØ§" },
    { question: "Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø¢Ø³ÙŠØ§", "Ø£ÙØ±ÙŠÙ‚ÙŠØ§"], correct: "Ø¢Ø³ÙŠØ§" },
    { question: "Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø¢Ø³ÙŠØ§", "Ø£ÙØ±ÙŠÙ‚ÙŠØ§"], correct: "Ø¢Ø³ÙŠØ§" }
  ];

  // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
  const container = document.getElementById("examContainer");
  examData.forEach((q, index) => {
    const div = document.createElement("div");
    div.classList.add("question");
    div.innerHTML = `<p>${index + 1}. ${q.question}</p>`;
    q.options.forEach(opt => {
      div.innerHTML += `
        <label>
          <input type="radio" name="q${index}" value="${opt}"> ${opt}
        </label><br>
      `;
    });
    container.appendChild(div);
  });

  // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
let examSubmitted = false;

window.addEventListener("beforeunload", (e) => {
  if (!examSubmitted) {
    e.preventDefault();
    e.returnValue = "Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù‚Ø¨Ù„ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.";
  }
});

// Ù…Ù†Ø¹ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ù„Ù Ø¨Ø²Ø± Back
history.pushState(null, null, location.href);
window.addEventListener('popstate', function () {
  if (!examSubmitted) {
    history.pushState(null, null, location.href);
    alert("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù‚Ø¨Ù„ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.");
  }
});

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
async function submitExamData() {
  const examName = document.getElementById("examName").value.trim();
  if (!examName) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†");

  let examResults = [];
  let correctCount = 0;

  for (let i = 0; i < examData.length; i++) {
    const q = examData[i];
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    const answer = selected ? selected.value : null;
    const isCorrect = answer === q.correct;
    if (isCorrect) correctCount++;

    examResults.push({
      question: q.question,
      studentAnswer: answer,
      correctAnswer: q.correct,
      isCorrect: isCorrect
    });
  }

  const resultData = {
    studentInfo: studentData,
    examName: examName,
    date: new Date().toISOString(),
    totalQuestions: examData.length,
    correctAnswers: correctCount,
    wrongAnswers: examData.length - correctCount,
    details: examResults
  };

  try {
    await setDoc(doc(db, studentData.studentId, examName), resultData);
    examSubmitted = true;
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­");
  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:", error);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
  }
}

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
document.getElementById("submitExam").addEventListener("click", submitExamData);

// Ø§Ù„Ø¹Ø¯Ø§Ø¯
let examDuration = 0.2; // Ø¯Ù‚Ø§Ø¦Ù‚
let timeRemaining = examDuration * 60;

function startTimer() {
  const timerElement = document.getElementById("timer");
  const timerInterval = setInterval(() => {
    let minutes = Math.floor(timeRemaining / 60);
    let seconds = timeRemaining % 60;
    timerElement.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
    timeRemaining--;
    if (timeRemaining < 0) {
      clearInterval(timerInterval);
      alert("â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.");
      submitExamData(); // Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ Ø­ØªÙ‰ Ù„Ùˆ Ù…ÙÙŠØ´ Ø¥Ø¬Ø§Ø¨Ø§Øª
    }
  }, 1000);
}

startTimer();
  
  // Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  function goBackAfterSubmit() {
    setTimeout(() => {
      window.history.back();
    }, 1500); // Ù…Ù‡Ù„Ø© Ù‚ØµÙŠØ±Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
  async function submitExamDataWithBack() {
    await submitExamData();
    goBackAfterSubmit();
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
  function startTimer() {
    const timerElement = document.getElementById("timer");
    const timerInterval = setInterval(() => {
      let minutes = Math.floor(timeRemaining / 60);
      let seconds = timeRemaining % 60;
      timerElement.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
      timeRemaining--;
      if (timeRemaining < 0) {
        clearInterval(timerInterval);
        alert("â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.");
        submitExamDataWithBack(); // Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ Ø«Ù… Ø§Ù„Ø±Ø¬ÙˆØ¹
      }
    }, 1000);
  }
</script>

</body>
</html>
